<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Breathing World - Alpha Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script>
        const selectedRegion = localStorage.getItem('selectedRegion');
        window.cdnPrefix = selectedRegion === null || selectedRegion == 'kr' ? '' : 'https://' + selectedRegion + '-alpha-bw.b-cdn.net';
        let totalTasks = 0; let completedTasks = 0;
        function loadCSS(href) {
            const link = document.createElement("link");
            link.rel = "stylesheet";
            link.type = "text/css";
            link.href = window.cdnPrefix + href;
            document.head.appendChild(link);
        }
        function loadScript(src, callback) {
            const script = document.createElement("script");
            script.src = window.cdnPrefix + src;
            script.onload = () => { if (typeof callback === "function") { if (src.indexOf('images.js') !== -1) { totalTasks += Images.PreloadData.length; } callback(); } };
            script.onerror = () => { console.error(`Failed to load script: ${script.src}`); };
            document.body.appendChild(script);
        }
        loadCSS("/css/common.css?8");
        const scripts = [
            "/js/images.js?13",
            "/js/lib/msgpack.min.js",
            "/js/lib/signalr.min.js",
            "/js/variables.js?14",
            "/js/data.js?7",
            "/js/animal.js?14",
            "/js/tree.js?11",
            "/js/methods.js?20",
            "/js/socket.js?32",
            "/js/chat.js?8",
            "/js/core.js?48",
            "https://cdn.jsdelivr.net/npm/pixi.js@8.14.0/dist/pixi.min.js",
            "https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",
            "/js/leaflet.js",
            "/js/frameInterpFilter.js"
        ];
        function updateProgress() { completedTasks++; const percent = Math.round((completedTasks / totalTasks) * 100); document.getElementById("progress-bar").style.width = percent + "%"; }
        function loadScriptsSequentially(index = 0) { if (index < scripts.length) { loadScript(scripts[index], () => { updateProgress(); loadScriptsSequentially(index + 1); }); } }
        document.addEventListener("DOMContentLoaded", () => {
            totalTasks = scripts.length;
            loadScriptsSequentially();
        });
    </script>
    <script type="module" src="./js/index.js"></script>
</head>

<body>
    <div id="loading-screen">
        <div id="progress-bar-container">
            <div id="progress-bar"></div>
        </div>
    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-76TZPZS6VM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-76TZPZS6VM', {
            cookie_flags: 'SameSite=None;Secure'
        });
    </script>
</body>

</html>